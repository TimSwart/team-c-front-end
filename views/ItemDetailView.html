<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Current Inventory</title>
    <link rel="stylesheet" href="stylesheets/style.css">
    <link rel="stylesheet" href="stylesheets/bootstrap.min.css">
    <script src="javascripts/jquery-1.11.3.min.js"></script>
    <script src="javascripts/bootstrap.min.js"></script>
    <style>
        .thumbnail {
            width: 128px;
            height: 128px;
            background-color: red;
            margin-right: 24px;
        }
    </style>
</head>

<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-4">
            <div class="thumbnail unimplemented">Thumbnail</div>
        </div>

        <div id="details" class="col-sm-8">
        </div>
    </div>
    <br/>
    <div id="buttons" class="row">
        <button class="col-sm-2" onclick="itemDetailView.add()">Add</button>
        <button class="col-sm-2" onclick="itemDetailView.pull()">Pull</button>
        <button class="col-sm-2" onclick="itemDetailView.edit()">Edit</button>
    </div>

    <br/><hr/><br/>

    <div id="history" class="row">
        History
    </div>

    <div id="error_message"></div>
</div>
<script>
    var itemDetailView = {
        productID: null,
        productName: "",
        item: null,

        init: function() {
            this.productID = window.args.ProductID;

            var self = this;

            $.get(window.apiRoute + "/itemDetail/" + this.productID, function(response) {
                if(response && response.length) {
                    self.item = jQuery.parseJSON(response)[0];
                    //console.log(self.item);
                    self.displayItem();
                    self.productName = self.item.Name;
                } else {
                    self.renderError("No inventory found");
                }
            }).fail(function(response) {
                self.renderError("Failed to load inventory: " + response );
            });
        },

        displayItem: function() {
            $("#details").append("<div><h1>" + this.item.Name + "</h1></div>" +
                    "<div>Total Available: <span>" + this.item.TotalAvailable + "</span></div>" +
                    "<div>Total Reserved: <span>" + this.item.TotalReserved + "</span></div>" +
                    "<div>Last run: <span>" + this.item.MostRecent + "</span></div>");
        },

        renderError: function(error) {
            $("#error_message").text(error);
        },

        add: function() {
            navigation.go("AddInventory.html", {ProductID:itemDetailView.productID, ProductName:itemDetailView.productName, PreviousPage:"ItemDetailView.html"});
        },

        pull: function() {
            navigation.go("PullInventory.html", {ProductID:itemDetailView.productID, ProductName:itemDetailView.productName, PreviousPage:"ItemDetailView.html"});
        },

        edit: function() {
            navigation.go("EditProduct.html", {ProductID:itemDetailView.productID, ProductName:itemDetailView.productName, PreviousPage:"ItemDetailView.html"});
        }
    };

    $(function() {
        itemDetailView.init();
    });
</script>
</body>
</html>
